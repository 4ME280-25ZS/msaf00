<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wishlist</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container">
    <header>
      <h1>Wishlist</h1>
      <p class="subtitle">Jednoduchý seznam dárků.</p>
    </header>

    <section>
      <h2>Seznam dárků</h2>
      <ul id="wishlist">
        <li><span class="item">Kvalitní termoláhev</span><input class="picker" data-index="0" placeholder="Vaše jméno"></li>
        <li><span class="item">Dárkový poukaz na kávu</span><input class="picker" data-index="1" placeholder="Vaše jméno"></li>
        <li><span class="item">Pohodlné pracovní rukavice</span><input class="picker" data-index="2" placeholder="Vaše jméno"></li>
        <li><span class="item">Teplá čepice</span><input class="picker" data-index="3" placeholder="Vaše jméno"></li>
        <li><span class="item">Balíček výběrové kávy</span><input class="picker" data-index="4" placeholder="Vaše jméno"></li>
        <li><span class="item">Multitool (nástroj do kapsy)</span><input class="picker" data-index="5" placeholder="Vaše jméno"></li>
        <li><span class="item">Pohodlné pracovní boty</span><input class="picker" data-index="6" placeholder="Vaše jméno"></li>
        <li><span class="item">Předplatné audioknih</span><input class="picker" data-index="7" placeholder="Vaše jméno"></li>
        <li><span class="item">Přenosný kávovar</span><input class="picker" data-index="8" placeholder="Vaše jméno"></li>
        <li><span class="item">Dárková karta do místního obchodu</span><input class="picker" data-index="9" placeholder="Vaše jméno"></li>
      </ul>
    </section>

    <footer>
      <p>© 2026</p>
    </footer>
    <!-- Optional Supabase integration: create wishlist/supabase.js from supabase.example.js -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
    <script>
      (function(){
        const inputs = Array.from(document.querySelectorAll('#wishlist .picker'));
        // fallback storage functions (localStorage)
        const local = {
          async loadAll(){ return JSON.parse(localStorage.getItem('wishlistNames') || '{}'); },
          async save(idx, name){ const s = JSON.parse(localStorage.getItem('wishlistNames') || '{}'); s[idx]=name; localStorage.setItem('wishlistNames', JSON.stringify(s)); }
        };

        // try to initialize Supabase if wishlist/supabase.js exists and defines SUPABASE_CONFIG
        async function initSupabase(){
          if (!window.SUPABASE_CONFIG) return null;
          const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.SUPABASE_CONFIG;
          if (!SUPABASE_URL || !SUPABASE_ANON_KEY) return null;
          try{
            const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            // verify connection by selecting (optional)
            return client;
          }catch(e){ return null }
        }

        (async function(){
          const supa = await initSupabase();
          if (supa){
            // load from Supabase table `wishlist_names` if present
            try{
              const { data, error } = await supa.from('wishlist_names').select('gift_index,name');
              if (!error && data){
                const map = {};
                data.forEach(r => { map[r.gift_index]=r.name; });
                inputs.forEach(input => {
                  const idx = input.dataset.index;
                  if (map[idx]) input.value = map[idx];
                  input.addEventListener('input', async e => {
                    const val = e.target.value;
                    await supa.from('wishlist_names').upsert({ gift_index: parseInt(idx,10), name: val });
                  });
                });
                return;
              }
            }catch(err){ /* fall back to local */ }
          }

          // fallback: localStorage
          const saved = await local.loadAll();
          inputs.forEach(input => {
            const idx = input.dataset.index;
            if (saved[idx]) input.value = saved[idx];
            input.addEventListener('input', e => local.save(idx, e.target.value));
          });
        })();

      })();
    </script>
  </main>
</body>
</html>
